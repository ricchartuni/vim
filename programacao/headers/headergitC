:insert
//#define _USE_MPIONLY__
#ifdef _USE_MPIONLY__
#ifdef _USAR_MPI___
#define _BUILD_MYBINARY___
#define _USAR_MAINMPI___
#endif
#else
#define _BUILD_MYBINARY___
#endif
//---------------------------
#ifdef _BUILD_MYBINARY___
//---------------------------
#define __XXXXXXX_C__
#include "XXXXXXX.h"
//---------------------------
#include <assert.h>
#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
//---------------------------
#ifdef _USAR_MPI___
#ifndef _USAR_MAINMPI___
//#define _USAR_MAINMPI___
#endif
#endif
//---------------------------
#include "mydbg.h"
#ifdef _DEBUG___
//#define _LOCALDEBUG___
#endif
//---------------------------
#include "constantes.h"
#include "myrsf.h"
#include "rsfinp.h"
#include "rsfutl.h"
#include "alloc.h"
#include "mpiutl.h"
#include "defclock.h"
#include "mylog.h"
//---------------------------
#define __MYRSFCMDOPC__
#ifdef __MYRSFCMDOPC__
#define myrsfinit(AC,AV) rsfopcinit(AC,AV)
#else
#define myrsfinit(AC,AV) rsfinit(AC,AV)
#endif
//---------------------------
#define PROG_INIT "Initialize program"
#define PROGALLOC "Program allocation"
#define PROC_INFO "Proccessing"
#define PROC__MPI "MPI-trace proccessing"
#define PROG_KILL "Finalize program"
//---------------------------
#define INPUT__PARM    "inp"
#define OUTPUT_PARM    "out"
//---------------------------
#define CERR_NOTDEFINED   "Error not defined .........."
//---------------------------
//---------------------------
//---------------------------
static FILE    * flog;
//---------------------------

//======================================================================
   static void main_proc(){
//---------------------------------------------------------------------
int n2tot = 2;
      // -----------------------
      // CLOCK proccess ........
      defclock_proc();
      // -----------------------
      char* cjob = PROC__MPI;
      int   njob = n2tot;
#ifdef _USAR_MAINMPI___
      if(ismanager())
         mpisendalltasks(njob, cjob, flog);
      else{
#endif
         mpitask_str task;
         int irecv = mpiworker_taskbeg(&task, njob, cjob, flog);
         while(irecv >= 0){
            MYLOG_PRN("main_proc ...... %d\n", irecv);
            irecv = mpireceivetask(task);
         }
#ifdef _USAR_MAINMPI___
         mympi_worker_sumf(nstot, saux[0], seis[0]);
      }
#endif
   }
//======================================================================
//======================================================================
   static void main_write(){
//---------------------------------------------------------------------
#ifdef _USAR_MAINMPI___
      if(am_i_rank(1)){
#endif
         // -----------------------
         // CLOCK write ...........
         defclockwrite();
         // -----------------------
         MYLOG_PRN("output write .....\n");
// ** RChartuni >>         sf_floatwrite(seis[0],nstot,sfout);
#ifdef _USAR_MAINMPI___
      }
#endif
   }
//======================================================================
//======================================================================
   static void main_read(){
//---------------------------------------------------------------------
      // -----------------------
      // CLOCK read ............
      defclock_read();
      // -----------------------
      MYLOG_PRN("input read .......\n");
// ** RChartuni >>      sf_floatread(seis[0],nstot,sfinp);
   }
//======================================================================
//======================================================================
   static void main_free(){
//---------------------------------------------------------------------
      MYLOG_PRN("free memory ......\n");
   }
//======================================================================
//======================================================================
   static void main_null(){
//---------------------------------------------------------------------
      MYLOG_PRN("null variables ...\n");
   }
//======================================================================
//======================================================================
   static void main_alloc(){
//---------------------------------------------------------------------
      // -----------------------
      // CLOCK alloc ...........
      defclockalloc();
      // -----------------------
      MYLOG_PRN("allocate .........\n");
// ** RChartuni >>      seis = arr_malloc2F(n2tot,n1);
// ** RChartuni >>      main_err(!seis, IERR_SEIS__ALLOC);
   }
//======================================================================
//======================================================================
   static void main_output(){
//---------------------------------------------------------------------
// ** RChartuni >>      main_err(!rsfparcheckall(OUTPUT_PARM), IERR_SEIS_OUTPUT);
#ifdef _USAR_MAINMPI___
      if(am_i_rank(1)){
#endif
         MYLOG_PRN("output flush .....\n");
// ** RChartuni >>         sfout = sf_output(OUTPUT_PARM);
// ** RChartuni >>         sf_fileflush(sfout, sfinp);
#ifdef _USAR_MAINMPI___
      }
#endif
   }
//======================================================================
//======================================================================
   static void main_input(){
//---------------------------------------------------------------------
// ** RChartuni >>      main_err(!rsfparcheckall(INPUT__PARM)   , IERR_SEIS__INPUT);
      MYLOG_PRN("define input .....\n");
// ** RChartuni >>      sfinp = sf_input(INPUT__PARM);
// ** RChartuni >>      main_err(!sf_getfloat(CLIP___PARM,&clip), IERR_INPUT__CLIP);
// ** RChartuni >>      rsfxDinfo(rsffloat, sfinp, &n1,&o1,&d1,
// ** RChartuni >>       &n2,&o2,&d2, &n3,&o3,&d3, &n4,&o4,&d4);
   }
//======================================================================
//======================================================================
   static char *main_errtype(const int itype, char *cerr){
//---------------------------------------------------------------------
      switch(itype){
         default:
            strcpy(cerr, CERR_NOTDEFINED);
            break;
      }
      return cerr;
   }
//======================================================================
//======================================================================
   int main(int argc, char *argv[]){
//---------------------------------------------------------------------
//  ..................................................... Main program
//  Do not need to change from here ..................................
//---------------------------------------------------------------------
//        *** Created by: .............. XXXNAMEXXX
//        *** Created on: .................... XX.XX.XXXX
//        *** Last modification: ..... XX:XX - XX.XX.XXXX
//        *** Modified by: ...........
//======================================================================
#define main_kill() main_kill0(0, NULL)
      // -----------------------
      // Initialize ............
      // -----------------------
      main_init(argc, argv);
      // -----------------------
      // Input parameters ......
      // -----------------------
      main_input();
      // -----------------------
      // Output parameters .....
      // -----------------------
      main_output();
#ifdef _USAR_MAINMPI___
      if(isworker()){
#endif
         // -----------------------
         MYLOG_HDR("%s\n",PROGALLOC);
         // -----------------------
         // Allocation ............
         // -----------------------
         main_alloc();
         // -----------------------
         // Read ..................
         // -----------------------
         main_read();
#ifdef _USAR_MAINMPI___
      }
#endif
      // -----------------------
      MYLOG_HDR("%s\n",PROC_INFO);
      // -----------------------
      // Proccess ..............
      // -----------------------
      main_proc();
      // -----------------------
      // Write .................
      // -----------------------
      main_write();
      // -----------------------
      // Finish program ........
      // -----------------------
      main_kill();
   }
//======================================================================
//======================================================================
   static void main_kill0(const int iend, char *cerr){
//---------------------------------------------------------------------
      // -----------------------
      MYLOG_HDR("%s\n",PROG_KILL);
      // -----------------------
      // CLOCK free ............
      defclock_free();
      // -----------------------
      // -----------------------
      // Free memory ...........
      // -----------------------
      main_free();
      // -----------------------
      // Finalize RSF ..........
      // -----------------------
      sf_close();
      // -----------------------
      // Finalize CLOCK ........
      // -----------------------
      if (iend == 0)
         defclock_kill(flog);
      // -----------------------
      // Finalize LOGFILE ......
      // -----------------------
      MYLOG_KILL(iend,cerr);
#ifdef _USAR_MAINMPI___
      // -----------------------
      // Finalize MPI ..........
      // -----------------------
      mympi_finalize();
#endif
      // -----------------------
      // Finalize Program ......
      // -----------------------
      exit(iend);
   }
//======================================================================
//======================================================================
   static void main_init(int argc, char *argv[]){
//---------------------------------------------------------------------
      // -----------------------
      // Initialize CLOCK ......
      // -----------------------
      defclock_init();
#ifdef _USAR_MAINMPI___
      // -----------------------
      // Initialize MPI ........
      // -----------------------
      mympi_init(argc,argv);
#endif
      // -----------------------
      // Initialize RSF ........
      // -----------------------
      myrsfinit(argc,argv);
      // -----------------------
      // Initialize LOGFILE ....
      // -----------------------
      flog = MYLOG_INIT(argv, sf_getstring("log"));
      // -----------------------
      MYLOG_HDR("%s\n",PROG_INIT);
      // -----------------------
      // NULL structures .......
      // -----------------------
      main_null();
   }
//======================================================================
//======================================================================
   static void main_err(const int iret, const int itype){
//---------------------------------------------------------------------
      if(iret == 0) return;
      // ------------------------
      // Found error ......
      // ------------------------
      char cerr[1024];
      main_errtype(itype, cerr);
      strcat(cerr, "\n");
      main_kill0(itype, cerr);
   }
//======================================================================
#else
#include "no_mpi.h"
#endif
.
